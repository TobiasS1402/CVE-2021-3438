function Get-VulnerablePrinter
{
    <#
        .SYNOPSIS
        Detects printerdrivers vulnerable to CVE-2021-3438.
        Author:
            Tobias, 28-07-2021

        .DESCRIPTION
        Detects printerdrivers vulnerable to CVE-2021-3438.
        Loops through the printerdrivers, lists potential vulnerable printers.

        .PARAMETER Name
        CVE-2021-3438_detection

        .EXAMPLE
        PS> import-module CVE-2021-3438_detection.ps1

        .EXAMPLE
        PS> Get-VulnerablePrinter


        .LINK
        Versions based on https://support.hp.com/us-en/document/ish_3900395-3833905-16/hpsbpi03724

    #>
    try{
        $printerDriver = Get-PrinterDriver -ErrorAction Stop
        
        $ManuFacturer = $printerDriver | Select-Object Name, Manufacturer | Where-Object {(
            $_.Manufacturer -Match "Samsung" -or
            $_.Manufacturer -Match "HP" -or
            $_.Manufacturer -Match "Xerox" -or
            $_.Manufacturer -Match "Hawlett" -or
            $_.Manufacturer -Match "Phaser" -or
            $_.Manufacturer -Match "WorkCentre")}
        
        if ($ManuFacturer.Count -eq 0) {
            Write-Host -ForegroundColor Green "No printers from vulnerable vendors have been found, stopping script..."
            Break
        }
        else {
            Write-Host -ForegroundColor Red $ManuFacturer.Count "possible vulnerable printer drivers have been found, checking models!"
        }
        $DriverModels = $ManuFacturer | Select-Object * | Where-Object {(
            $_.Name -Match "B205" -or
            $_.Name -Match "B210" -or
            $_.Name -Match "B215" -or
            $_.Name -Match "3020" -or
            $_.Name -Match "3052" -or
            $_.Name -Match "3260" -or
            $_.Name -Match "3320" -or
            $_.Name -Match "3025" -or
            $_.Name -Match "3215" -or
            $_.Name -Match "3225" -or
            $_.Name -Match "3315" -or
            $_.Name -Match "3325" -or

            $_.Name -Match "color laser 150" -or
            $_.Name -Match "color laser MFP" -or
            $_.Name -Match "HP Laser 10" -or
            $_.Name -Match "HP Laser 408" -or
            $_.Name -Match "HP Laser MFP 13" -or
            $_.Name -Match "MFP 432" -or
            $_.Name -Match "Laserjet MFP 42" -or
            $_.Name -Match "Laserjet MFP M43" -or
            $_.Name -Match "Laserjet MFP M44" -or
            $_.Name -Match "Laserjet MFP M726" -or
            $_.Name -Match "Laserjet MFP M726" -or

            $_.Name -Match "CLP" -or
            $_.Name -Match "CLX" -or
            $_.Name -Match "SCX" -or
            $_.Name -Match "SL-K" -or
            $_.Name -Match "SL-X" -or
            $_.Name -Match "SL-M" -or
            $_.Name -Match "SL-C" -or
            $_.Name -Match "ML-3750" -or
            $_.Name -Match "ML-451" -or
            $_.Name -Match "ML-501" -or
            $_.Name -Match "ML-551" -or
            $_.Name -Match "ML-651")}

            if ($DriverModels.Count -eq 0) {
                Write-Host -ForegroundColor Green "No potential vulnerable printer drivers have been found, stopping script..."
                Break
            }
            else {
                Write-Host -ForegroundColor Red "The following drivers are potentially vulnerable:" $DriverModels
            }
        }
    catch{
        Write-Host -ForegroundColor Yellow "The spooler service is not reachable"
    }  

}
Get-VulnerablePrinter